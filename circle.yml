dependencies:
  pre:
    - curl -u ${ARTIFACTORY_USER}:${ARTIFACTORY_PASSWORD} "${ARTIFACTORY_URL}/api/v1/api_key.yaml" > ~/.gem/credentials
    - sudo chmod 600 ~/.gem/credentials
  post:
    - bundle exec appraisal install
    - gem install gem-versioner -v 1.1.0

test:
  override:
    - bundle exec appraisal rspec

database:
  override:
    - echo 'This step has been intentionally skipped.'

deployment:
  master:
    branch: master
    owner: FundingCircle
    commands:
      - gem build "songkick-${CIRCLE_PROJECT_REPONAME}.gemspec"
      - gem push "songkick-${CIRCLE_PROJECT_REPONAME}"-*.gem --host "${ARTIFACTORY_URL}-local"
  dev:
    branch: /.*/
    owner: FundingCircle
    commands:
      - PRE_RELEASE=$CIRCLE_BRANCH gem build "songkick-${CIRCLE_PROJECT_REPONAME}.gemspec"
      - gem push "songkick-${CIRCLE_PROJECT_REPONAME}"-*.gem --host "${ARTIFACTORY_URL}-pre-releases"
